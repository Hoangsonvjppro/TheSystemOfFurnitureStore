<!-- Navbar -->
<nav class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="/" class="text-2xl font-bold text-primary-600">
                        <span class="text-gray-800">Nội Thất</span> <span class="text-primary-600">Cao Cấp</span>
                    </a>
                </div>
                
                <!-- Main Menu (Desktop) -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="/" class="border-transparent text-gray-700 hover:border-primary-500 hover:text-primary-600 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        Trang chủ
                    </a>
                    <a href="/pages/product_list.html" class="border-transparent text-gray-700 hover:border-primary-500 hover:text-primary-600 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        Sản phẩm
                    </a>
                    <a href="#" class="border-transparent text-gray-700 hover:border-primary-500 hover:text-primary-600 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        Bộ sưu tập
                    </a>
                    <a href="#" class="border-transparent text-gray-700 hover:border-primary-500 hover:text-primary-600 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        Về chúng tôi
                    </a>
                    <a href="#" class="border-transparent text-gray-700 hover:border-primary-500 hover:text-primary-600 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        Liên hệ
                    </a>
                </div>
            </div>
            
            <!-- Right Menu -->
            <div class="hidden sm:ml-6 sm:flex sm:items-center">
                <!-- Staff Dashboard Links (Hidden by default) -->
                <div class="staff-link admin-link hidden mr-3">
                    <a href="/pages/admin_dashboard.html" class="bg-gray-100 p-2 rounded-md text-gray-700 hover:text-primary-600">
                        <i class="fas fa-tachometer-alt mr-1"></i>
                        Quản trị
                    </a>
                </div>
                <div class="staff-link hidden mr-3">
                    <a href="/pages/inventory_dashboard.html" class="bg-gray-100 p-2 rounded-md text-gray-700 hover:text-primary-600">
                        <i class="fas fa-boxes mr-1"></i>
                        Kho hàng
                    </a>
                </div>
                <div class="staff-link hidden mr-3">
                    <a href="/pages/sales_dashboard.html" class="bg-gray-100 p-2 rounded-md text-gray-700 hover:text-primary-600">
                        <i class="fas fa-chart-line mr-1"></i>
                        Bán hàng
                    </a>
                </div>
                
                <!-- Search Button -->
                <button type="button" class="p-2 rounded-md text-gray-500 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <span class="sr-only">Tìm kiếm</span>
                    <i class="fas fa-search text-lg"></i>
                </button>

                <!-- Cart Button -->
                <a href="/pages/cart.html" class="ml-3 p-2 rounded-md text-gray-500 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 relative">
                    <span class="sr-only">Giỏ hàng</span>
                    <i class="fas fa-shopping-cart text-lg"></i>
                    <span class="cart-count absolute -top-1 -right-1 bg-primary-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">0</span>
                </a>

                <!-- Logout Button (Hidden by default) -->
                <button type="button" class="logout-button hidden ml-3 p-2 rounded-md text-gray-500 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <span class="sr-only">Đăng xuất</span>
                    <i class="fas fa-sign-out-alt text-lg"></i>
                </button>

                <!-- User Account Menu -->
                <div class="ml-3 relative">
                    <!-- User Menu Button -->
                    <div>
                        <!-- Show this for logged in users -->
                        <button type="button" class="user-menu-button hidden bg-white rounded-full flex text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                            <span class="sr-only">Mở menu người dùng</span>
                            <div class="h-8 w-8 rounded-full bg-primary-200 flex items-center justify-center">
                                <span class="user-info text-primary-700 font-medium">KH</span>
                            </div>
                        </button>
                        
                        <!-- Login button for anonymous users -->
                        <a href="/pages/login.html" class="login-button inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                            <i class="fas fa-user mr-1"></i>
                            Đăng nhập
                        </a>
                    </div>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-dropdown hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Hồ sơ cá nhân</a>
                        <a href="/pages/user_orders.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Đơn hàng của tôi</a>
                        <a href="#" class="logout-menu-item block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Đăng xuất</a>
                    </div>
                </div>
            </div>
            
            <!-- Mobile menu button -->
            <div class="flex items-center sm:hidden">
                <button type="button" class="p-2 rounded-md text-gray-500 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500" id="mobile-menu-button">
                    <span class="sr-only">Mở menu</span>
                    <i class="fas fa-bars text-xl"></i>
                </button>
                
                <!-- Mobile Cart -->
                <a href="/pages/cart.html" class="ml-2 p-2 rounded-md text-gray-500 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 relative">
                    <span class="sr-only">Giỏ hàng</span>
                    <i class="fas fa-shopping-cart text-lg"></i>
                    <span class="cart-count absolute -top-1 -right-1 bg-primary-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">0</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Mobile menu, show/hide based on menu state. -->
    <div class="sm:hidden hidden" id="mobile-menu">
        <div class="pt-2 pb-3 space-y-1">
            <a href="/" class="bg-gray-50 border-primary-500 text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                Trang chủ
            </a>
            <a href="/pages/product_list.html" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                Sản phẩm
            </a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                Bộ sưu tập
            </a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                Về chúng tôi
            </a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                Liên hệ
            </a>
            
            <!-- Staff Dashboard Links (Mobile) -->
            <div class="staff-link admin-link hidden border-t border-gray-200 pt-4 mt-4">
                <a href="/pages/admin_dashboard.html" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                    <i class="fas fa-tachometer-alt mr-1"></i>
                    Quản trị
                </a>
            </div>
            <div class="staff-link hidden">
                <a href="/pages/inventory_dashboard.html" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                    <i class="fas fa-boxes mr-1"></i>
                    Kho hàng
                </a>
            </div>
            <div class="staff-link hidden">
                <a href="/pages/sales_dashboard.html" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-primary-300 hover:text-primary-600 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
                    <i class="fas fa-chart-line mr-1"></i>
                    Bán hàng
                </a>
            </div>
        </div>
        
        <!-- Mobile user menu -->
        <div class="pt-4 pb-3 border-t border-gray-200">
            <!-- For logged in users -->
            <div class="flex items-center px-4 hidden mobile-user-info">
                <div class="flex-shrink-0">
                    <div class="h-10 w-10 rounded-full bg-primary-200 flex items-center justify-center">
                        <span class="user-info text-primary-700 font-medium">KH</span>
                    </div>
                </div>
                <div class="ml-3">
                    <div class="text-base font-medium text-gray-800 user-info">Nguyễn Văn A</div>
                    <div class="text-sm font-medium text-gray-500 user-email">user@example.com</div>
                </div>
                <button type="button" class="logout-button ml-auto flex-shrink-0 p-2 rounded-md text-gray-500 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <span class="sr-only">Đăng xuất</span>
                    <i class="fas fa-sign-out-alt text-lg"></i>
                </button>
            </div>
            
            <!-- Mobile menu items for logged in users -->
            <div class="mt-3 space-y-1 hidden mobile-user-menu">
                <a href="#" class="block px-4 py-2 text-base font-medium text-gray-600 hover:text-primary-600 hover:bg-gray-100">
                    Hồ sơ cá nhân
                </a>
                <a href="/pages/user_orders.html" class="block px-4 py-2 text-base font-medium text-gray-600 hover:text-primary-600 hover:bg-gray-100">
                    Đơn hàng của tôi
                </a>
                <a href="#" class="logout-menu-item block px-4 py-2 text-base font-medium text-gray-600 hover:text-primary-600 hover:bg-gray-100">
                    Đăng xuất
                </a>
            </div>
            
            <!-- For anonymous users -->
            <div class="mt-3 space-y-1 px-2 login-button">
                <a href="/pages/login.html" class="flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-user mr-2"></i>
                    Đăng nhập / Đăng ký
                </a>
            </div>
        </div>
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.querySelector('.user-dropdown');
        
        // Toggle user dropdown menu
        if (userMenuButton) {
            userMenuButton.addEventListener('click', function() {
                userDropdown.classList.toggle('hidden');
            });
            
            // Close the menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.add('hidden');
                }
            });
        }
        
        // Add logout functionality to all logout buttons
        document.querySelectorAll('.logout-button, .logout-menu-item').forEach(button => {
            button.addEventListener('click', function() {
                if (typeof handleLogout === 'function') {
                    handleLogout();
                }
            });
        });
        
        // Hiển thị UI dựa trên trạng thái đăng nhập
        if (typeof Auth !== 'undefined' && Auth.isAuthenticated()) {
            // Hiển thị menu người dùng
            userMenuButton.classList.remove('hidden');
            document.querySelector('.login-button').classList.add('hidden');
            document.querySelector('.mobile-user-info').classList.remove('hidden');
            document.querySelector('.mobile-user-menu').classList.remove('hidden');
            
            // Hiển thị thông tin người dùng
            const user = Auth.getUserInfo();
            if (user) {
                document.querySelectorAll('.user-info').forEach(el => {
                    el.textContent = user.full_name || user.username || 'User';
                });
                
                // Hiển thị email trong mobile menu
                const userEmailEl = document.querySelector('.user-email');
                if (userEmailEl && user.email) {
                    userEmailEl.textContent = user.email;
                }
                
                // Hiển thị link admin nếu là admin
                if (Auth.isAdmin()) {
                    document.querySelectorAll('.admin-link').forEach(el => {
                        el.classList.remove('hidden');
                    });
                }
                
                // Hiển thị link staff nếu là nhân viên
                if (Auth.isStaff()) {
                    document.querySelectorAll('.staff-link').forEach(el => {
                        el.classList.remove('hidden');
                    });
                }
            }
        }
    });
</script>
